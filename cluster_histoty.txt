–°–≤–æ–¥–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ (–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è)
üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
–í–µ—Ä—Å–∏—è Kubernetes: v1.28.15
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤: 7 —É–∑–ª–æ–≤ (3 control-plane, 4 worker)
–î–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ –û–°: RED OS 8.0 (–∞–Ω–∞–ª–æ–≥ RHEL/CentOS)
Container Runtime: CRI-O v1.32.6

üåê –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
Kubernetes API: 10.10.2.110 (–≤–Ω–µ—à–Ω–∏–π –∞–¥—Ä–µ—Å)
Ingress Controller: 10.10.2.111 (–≤–Ω–µ—à–Ω–∏–π –∞–¥—Ä–µ—Å)
Pod —Å–µ—Ç—å: 10.233.0.0/16
Service —Å–µ—Ç—å: 10.233.0.0/16
–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ IP —É–∑–ª–æ–≤: 10.10.2.100-106
LoadBalancer: MetalLB v0.15.2 (L2 mode), –ø—É–ª 10.10.2.111
Ingress: Nginx Ingress v1.9.6
–î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è: ccsfarm.local

üíæ –•—Ä–∞–Ω–∏–ª–∏—â–µ
–û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: NFS –Ω–∞ 10.10.1.53:/tank01/VM_storage (>300TB)
StorageClass: managed-nfs-storage (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
Provisioner: nfs-subdir-external-provisioner v4.0.1
MinIO: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
–í–∞–∂–Ω–æ–µ: –î–ª—è —Ä–∞–±–æ—Ç—ã —Å NFS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è securityContext.runAsUser: 65534

üöÄ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
–†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
ArgoCD v3.12+: GitOps —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º TLS –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
Cert-manager: –°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ ClusterIssuer
Nginx Ingress: –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º —á–µ—Ä–µ–∑ 10.10.2.111
MinIO: –û–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ + MinIO Console
Kubernetes API: –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ 10.10.2.110

–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
GitLab: –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π –∏ CI/CD

üîß –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
DNS Resolution
–ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–º–µ–Ω –∏–∑-–∑–∞ wildcard-–∑–∞–ø–∏—Å–∏ –≤ BIND9
–†–µ—à–µ–Ω–∏–µ: –£–¥–∞–ª–µ–Ω–∞ wildcard-–∑–∞–ø–∏—Å—å –∏–∑ –∑–æ–Ω—ã ccsfarm.local
–†–µ–∑—É–ª—å—Ç–∞—Ç: –°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö DNS-–∏–º–µ–Ω

–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ NFS
–ü—Ä–æ–±–ª–µ–º–∞: chown: /var/lib/postgresql/data: Operation not permitted
–†–µ—à–µ–Ω–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ securityContext.runAsUser: 65534 –¥–ª—è –≤—Å–µ—Ö Pod'–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö NFS
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
yaml
securityContext:
  runAsUser: 65534
  runAsNonRoot: true

‚ö†Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
–°–µ—Ç–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
External Traffic Policy: Local (–≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å hairpin traffic)
DNS: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π BIND9 —Å–µ—Ä–≤–µ—Ä (10.10.1.151)
–î–æ—Å—Ç—É–ø –∫ GitHub: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –≤–º–µ—Å—Ç–æ SSH

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–†–µ–∂–∏–º: Development/Staging (–Ω–µ production-ready)
–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã: –°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ cert-manager
–î–æ—Å—Ç—É–ø: –ß–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ–º–µ–Ω ccsfarm.local

üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
–î–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
–í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞—Ç—å securityContext.runAsUser: 65534 –¥–ª—è Pod'–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö NFS
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π StorageClass managed-nfs-storage
–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å Ingress —Å –¥–æ–º–µ–Ω–æ–º *.ccsfarm.local —á–µ—Ä–µ–∑ 10.10.2.111
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MinIO –¥–ª—è –æ–±—ä–µ–∫—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è, –≥–¥–µ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏
GitLab - –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π –∏ CI/CD
PostgreSQL + PgAdmin - –∫–∞–∫ –±–∞–∑–∞ –¥–ª—è GitLab –∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
–°–ª–µ–¥–∏—Ç—å –∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –≤–Ω–µ—à–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º
–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–º–µ–Ω—É externalTrafficPolicy –Ω–∞ Cluster –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∞

–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: –ö–ª–∞—Å—Ç–µ—Ä —Å—Ç–∞–±–∏–ª–µ–Ω, –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (ArgoCD, MinIO, Nginx Ingress). –ì–æ—Ç–æ–≤ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ GitLab –∏ –¥—Ä—É–≥–∏—Ö –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

# üìë –°–≤–æ–¥–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ (v3.0)
**–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:** 22 –ù–æ—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** Production / On-premise / Secured (HTTPS)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
*   **–í–µ—Ä—Å–∏—è Kubernetes:** v1.28.15
*   **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤:** 7 —É–∑–ª–æ–≤ (3 Control-plane, 4 Worker)
*   **–û–°:** RED OS 8.0
*   **Container Runtime:** CRI-O v1.32.6
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (PKI):** –†–∞–∑–≤–µ—Ä–Ω—É—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π **Internal Root CA** (—á–µ—Ä–µ–∑ `cert-manager`). –ö–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ —Ä–∞–±–æ—á–∏—Ö —Å—Ç–∞–Ω—Ü–∏—è—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

## üåê –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
*   **–î–æ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞:** `ccsfarm.local`
*   **–í–Ω–µ—à–Ω–∏–µ –∞–¥—Ä–µ—Å–∞:**
    *   Kubernetes API: `10.10.2.110`
    *   Ingress Controller (VIP): `10.10.2.111`
*   **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è:**
    *   **Service —Å–µ—Ç—å:** `10.233.0.0/18`
    *   **Pod —Å–µ—Ç—å:** `10.233.64.0/18`
*   **Ingress:** Nginx Ingress v1.9.6 + MetalLB (L2 mode).
*   **–°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `kube-controller-manager`, `kube-scheduler`, `etcd` –ø–µ—Ä–µ–Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ `0.0.0.0` –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.

## üíæ –•—Ä–∞–Ω–∏–ª–∏—â–µ
*   **NFS:** `10.10.1.53:/tank01/VM_storage` (>300TB)
*   **StorageClass:** `managed-nfs-storage` (default)
*   **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** `securityContext.runAsUser: 65534` (nobody).

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –°–ï–†–¢–ò–§–ò–ö–ê–¢–´
*   **Issuer:** `ccsfarm-ca-issuer` (ClusterIssuer).
*   **Root CA:** –•—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–µ–∫—Ä–µ—Ç–µ, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω –Ω–∞ –Ω–æ–¥—ã —á–µ—Ä–µ–∑ `update-ca-trust`.
*   **HTTPS:** –í–∫–ª—é—á–µ–Ω –¥–ª—è –≤—Å–µ—Ö –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (GitLab, Nexus, Grafana, Prometheus –∏ –¥—Ä.).

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì (Kube-Prometheus-Stack)
*   **–°—Ç–µ–∫:** Prometheus + Alertmanager + Grafana + NodeExporter.
*   **–í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø:**
    *   **Grafana:** `https://grafana.ccsfarm.local` (admin/admin).
    *   **Prometheus:** `https://prom.ccsfarm.local` (–∑–∞—â–∏—â–µ–Ω Basic Auth).
*   **–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã (Exporters):**
    *   **Redis:** `redis-exporter` (–ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Redis).
    *   **Postgres:** `postgres-exporter` (–ø–æ–¥–∫–ª—é—á–µ–Ω —á–µ—Ä–µ–∑ DSN —Å—Ç—Ä–æ–∫—É).
    *   **MinIO:** –ù–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—Ä–µ–∂–∏–º `public`).
    *   **Cert-Manager:** –ù–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏.
*   **ServiceMonitors:** –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è GitLab (Webservice, Workhorse, Sidekiq), Runner, MinIO, Cert-Manager.

---

## ‚úÖ –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ù–´–ï –°–ï–†–í–ò–°–´

### üì¶ Nexus Repository Manager (HTTPS)
*   **UI / Maven / NuGet:** `https://nexus.ccsfarm.local` (–ø–æ—Ä—Ç 8081).
*   **Docker Registry:** `https://registry-nexus.ccsfarm.local` (–ø–æ—Ä—Ç 8082).
*   **Auth:** –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω `Docker Bearer Token Realm` (–¥–ª—è Kaniko).

### üóÑÔ∏è MinIO (Object Storage)
*   **–î–æ—Å—Ç—É–ø:** `https://minio.ccsfarm.local`
*   **–†–µ–∂–∏–º:** 3 –Ω–æ–¥—ã.
*   **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:** GitLab Runner –æ–±—â–∞–µ—Ç—Å—è —Å MinIO –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø–æ HTTP (`minio.minio.svc...`) –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ç–µ–ª—å SSL.

### üêò –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
*   **PostgreSQL 16:** –í–Ω–µ—à–Ω–∏–π StatefulSet, –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–º.
*   **Redis:** Standalone, –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–º.

---

## üîß GITLAB 18 (–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å)
*   **URL:** `https://gitlab.ccsfarm.local`
*   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
    *   **IP Whitelist:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ—Ç—å `10.233.0.0/16` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ü—Ä–æ–º–µ—Ç–µ—É—Å–∞ –∫ –º–µ—Ç—Ä–∏–∫–∞–º –±–µ–∑ –ø–∞—Ä–æ–ª—è.
    *   **Workhorse Metrics:** –í–∫–ª—é—á–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É `9229`.
    *   **HTTPS:** –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç Internal CA.

### üèÉ GitLab Runner & CI/CD
*   **–¢–∏–ø:** Kubernetes Executor.
*   **SSL:** –í –ø–æ–¥—ã Runner'–∞ –∏ –ø–æ–¥—ã —Å–±–æ—Ä–æ–∫ (Jobs) –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è **Root CA** –≤ –ø–∞–ø–∫—É `/custom-certs/` (–≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ `is a directory`).
*   **–°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (Kaniko):**
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `registry-nexus.ccsfarm.local`.
    *   –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç CA –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `--registry-certificate`.
    *   –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `config.json` —Å —Ç–æ—á–Ω—ã–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ–º —Ö–æ—Å—Ç–∞.

---

## ‚ö†Ô∏è –ö–ê–†–¢–ê –î–û–°–¢–£–ü–ê (Endpoints)
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ **HTTPS** —Å –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º:

1.  **GitLab:** `gitlab.ccsfarm.local`
2.  **Nexus UI:** `nexus.ccsfarm.local`
3.  **Nexus Docker:** `registry-nexus.ccsfarm.local`
4.  **Grafana:** `grafana.ccsfarm.local`
5.  **Prometheus:** `prom.ccsfarm.local`
6.  **Alertmanager:** `alertmanager.ccsfarm.local`
7.  **MinIO:** `minio.ccsfarm.local`
8.  **ArgoCD:** `argocd.ccsfarm.local`
9.  **PgAdmin:** `pg.ccsfarm.local`
10. **Frigate:** `frigate.ccsfarm.local`



–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ **–ø–æ–ª–Ω–∞—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —Å–≤–æ–¥–∫–∞ (v4.0)**. –û–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –≤–∞—à–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–∑ —Å—Ç–∞—Ä–æ–π —Å–≤–æ–¥–∫–∏ (GitLab, Nexus, –°–µ—Ç—å) –∏ –∞–∫—Ç—É–∞–ª—å–Ω—É—é, —Ä–∞–±–æ—Ç–∞—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –≤–∞—à–∞ —Ç–æ—á–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ ("Save Point") –¥–ª—è –ª—é–±—ã—Ö –±—É–¥—É—â–∏—Ö —Ä–∞–±–æ—Ç.

---

# üìë –°–≤–æ–¥–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ (v4.0)
**–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:** 23 –ù–æ—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** Production / Stable / Full Observability
**–¢–µ–∫—É—â–µ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ:** –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ Loki –≤ —Ä–µ–∂–∏–º–µ Simple Scalable —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤ –≤ MinIO (S3).

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
*   **–ö–ª–∞—Å—Ç–µ—Ä:** v1.28.15, 7 —É–∑–ª–æ–≤ (3 Control-plane, 4 Worker).
*   **–û–° / Runtime:** RED OS 8.0 / CRI-O v1.32.6.
*   **–•—Ä–∞–Ω–∏–ª–∏—â–µ (Storage):**
    *   **NFS:** `10.10.1.53:/tank01/VM_storage` (>300TB).
    *   **StorageClass:** `managed-nfs-storage` (–ø—Ä–∞–≤–∞ `nobody:65534`).
    *   **S3 (MinIO):** –ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 3 –Ω–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–æ–≤ (Loki), –±—ç–∫–∞–ø–æ–≤ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (PKI):**
    *   **Internal Root CA:** –†–∞–∑–≤–µ—Ä–Ω—É—Ç —á–µ—Ä–µ–∑ `cert-manager` + `ccsfarm-ca-issuer`.
    *   **Trust:** –ö–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–Ω–µ–¥—Ä–µ–Ω –Ω–∞ —É—Ä–æ–≤–Ω–µ –û–° –Ω–æ–¥ (`update-ca-trust`) –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ CI/CD –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.

---

## üåê –°–µ—Ç—å (Networking)
*   **–î–æ–º–µ–Ω:** `ccsfarm.local`
*   **–ê–¥—Ä–µ—Å–∞—Ü–∏—è:**
    *   **API / Ingress VIP:** `10.10.2.110` / `10.10.2.111`
    *   **Pods:** `10.233.64.0/18`
    *   **Services:** `10.233.0.0/18`
*   **Ingress:** Nginx Ingress v1.9.6 + MetalLB (L2 mode).
*   **–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã k8s (`controller-manager`, `scheduler`, `etcd`) —Å–ª—É—à–∞—é—Ç `0.0.0.0` –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.

---

## üìú –õ–û–ì–ì–ò–†–û–í–ê–ù–ò–ï (Loki Stack - –ì–û–¢–û–í–û ‚úÖ)
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Loki (Simple Scalable) + Promtail + MinIO.
**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
*   **–†–µ–∂–∏–º:** 3 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ (Read, Write, Backend) + Gateway.
*   **–•—Ä–∞–Ω–∏–ª–∏—â–µ:** MinIO (bucket `loki-data`).
*   **Discovery:** Memberlist (Ring) —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ `${POD_IP}`.
*   **–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã S3:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ **`structuredConfig`** –¥–ª—è –æ–±—Ö–æ–¥–∞ —à–∞–±–ª–æ–Ω–æ–≤ Helm.
    *   **Endpoint:** –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω `http://minio.minio.svc.cluster.local:9000`.
    *   **Auth:** –ö–ª—é—á–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ `extraEnv` (`AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`).
    *   **Flags:** `s3forcepathstyle: true` (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è MinIO).
*   **Promtail:** –°–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ —Å–æ –≤—Å–µ—Ö –Ω–æ–¥, —Ç–µ–≥–∏—Ä—É–µ—Ç –ø–æ namespace/pod/container.

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì (Kube-Prometheus-Stack)
*   **–°—Ç–µ–∫:** Prometheus + Alertmanager + Grafana + NodeExporter.
*   **–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã:**
    *   **Redis / Postgres:** –ü–æ–¥–∫–ª—é—á–µ–Ω—ã –∏ —Å–æ–±–∏—Ä–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏ –ë–î.
    *   **MinIO:** –ù–∞—Ç–∏–≤–Ω—ã–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (—Ä–µ–∂–∏–º `public`).
    *   **GitLab:** Webservice, Sidekiq, Workhorse, Runner.
*   **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** Grafana –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ Prometheus (–º–µ—Ç—Ä–∏–∫–∏) –∏ Loki (–ª–æ–≥–∏).

---

## üîß GITLAB & CI/CD
*   **–í–µ—Ä—Å–∏—è:** GitLab 18 (Omnibus/Cloud Native components).
*   **Runner:** Kubernetes Executor.
*   **–°–±–æ—Ä–∫–∞ (Kaniko):**
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π Nexus Registry (`registry-nexus.ccsfarm.local`).
    *   **SSL Fix:** –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç CA –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ `/custom-certs/` –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `--registry-certificate`.
*   **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏:** `10.233.0.0/16` –≤ Whitelist –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

---

## ‚úÖ –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ù–´–ï –°–ï–†–í–ò–°–´
1.  **Nexus Repository:**
    *   HTTPS (`nexus.ccsfarm.local`).
    *   Docker Registry –Ω–∞ –ø–æ—Ä—Ç—É 8082 (`registry-nexus...`).
    *   –ù–∞—Å—Ç—Ä–æ–µ–Ω `Docker Bearer Token Realm`.
2.  **MinIO:**
    *   –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø: `http://minio.minio.svc.cluster.local:9000` (–¥–ª—è Loki/Runner).
    *   –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø: HTTPS Console.
3.  **–ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö:**
    *   PostgreSQL 16 (StatefulSet).
    *   Redis (Standalone).

---

## ‚ö†Ô∏è –ö–ê–†–¢–ê –î–û–°–¢–£–ü–ê (Endpoints Map)
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ HTTPS:

| –°–µ—Ä–≤–∏—Å | URL | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **GitLab** | `https://gitlab.ccsfarm.local` | Main Repo / CI |
| **Nexus** | `https://nexus.ccsfarm.local` | Artifacts |
| **Registry** | `https://registry-nexus.ccsfarm.local` | Docker Images |
| **Grafana** | `https://grafana.ccsfarm.local` | Dashboards / Logs |
| **Prometheus**| `https://prom.ccsfarm.local` | Metrics Source |
| **Alertmgr** | `https://alertmanager.ccsfarm.local` | Alerts |
| **MinIO** | `https://minio.ccsfarm.local` | S3 Browser |
| **ArgoCD** | `https://argocd.ccsfarm.local` | GitOps |
| **PgAdmin** | `https://pg.ccsfarm.local` | DB Admin |
| **Frigate** | `https://frigate.ccsfarm.local` | NVR |

---
### üìù –ß—Ç–æ –¥–∞–ª—å—à–µ?
–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫:
1.  –ù–∞—Å—Ç—Ä–æ–π–∫–µ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ –≤ Prometheus (–ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è Loki —É–∂–µ –µ—Å—Ç—å –≤ —á–∞—Ä—Ç–µ).
2.  –í–≤–æ–¥—É Bare Metal –Ω–æ–¥—ã (–∫–æ—Ç–æ—Ä–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–∞—Å—å –¥–ª—è –ë–î).
3.  –¢—é–Ω–∏–Ω–≥—É Retention Policy –¥–ª—è –ª–æ–≥–æ–≤ (—Å–µ–π—á–∞—Å 30 –¥–Ω–µ–π).
---

üìë –°–≤–æ–¥–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ (v5.0)



–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏: 23 –ù–æ—è–±—Ä—è 2025
–°—Ç–∞—Ç—É—Å: Production Ready / Full Observability
–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ (NTP), –Ω–∞—Å—Ç—Ä–æ–µ–Ω Alertmanager (Telegram), –∑–∞–ø—É—â–µ–Ω Loki (S3).
üèóÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
–ö–ª–∞—Å—Ç–µ—Ä: Kubernetes v1.28.15 (7 —É–∑–ª–æ–≤: 3 CP, 4 Worker).
–û–°: RED OS 8.0 (RHEL-based) + CRI-O v1.32.6.
–í—Ä–µ–º—è (NTP): –ù–∞—Å—Ç—Ä–æ–µ–Ω chronyd —Å –ø—É–ª–∞–º–∏ Yandex/Google.
–°–µ—Ç—å:
CNI: Calico.
Ingress: Nginx + MetalLB (VIP: 10.10.2.111).
DNS: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∑–æ–Ω–∞ ccsfarm.local (–±–µ–∑ wildcard).
–•—Ä–∞–Ω–∏–ª–∏—â–µ:
NFS: –û—Å–Ω–æ–≤–Ω–æ–µ (managed-nfs-storage), –ø—Ä–∞–≤–∞ nobody:65534.
MinIO: S3 Object Storage (3 –Ω–æ–¥—ã) –¥–ª—è –ª–æ–≥–æ–≤, –±—ç–∫–∞–ø–æ–≤ –∏ GitLab.
üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (PKI)
CA: –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π Internal Root CA (—á–µ—Ä–µ–∑ cert-manager).
Trust: –ö–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–Ω–µ–¥—Ä–µ–Ω –Ω–∞ —Ö–æ—Å—Ç—ã –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ CI/CD –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
HTTPS: –¢–æ—Ç–∞–ª—å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.
üëÅÔ∏è –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (Observability)
1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus Stack)
–°—Ç–µ–∫: Prometheus + Alertmanager + Grafana + NodeExporter.
–ê–ª–µ—Ä—Ç–∏–Ω–≥:
–ö–∞–Ω–∞–ª: Telegram.
–í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏: –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ https://prom.ccsfarm.local.
–ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ (Inhibition): –í–∫–ª—é—á–µ–Ω–æ (Critical –≥–ª—É—à–∏—Ç Info).
–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã: Redis, Postgres, GitLab, MinIO, Cert-Manager.
2. –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Loki Stack)
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Simple Scalable (Read/Write/Backend).
–•—Ä–∞–Ω–∏–ª–∏—â–µ: MinIO (bucket loki-data).
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ structuredConfig –¥–ª—è –ø—Ä—è–º–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ S3.
Ruler: –í–∫–ª—é—á–µ–Ω, —Å–≤—è–∑–∞–Ω —Å Alertmanager.
üì¶ –ö–ª—é—á–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã (Endpoints)
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ HTTPS:
DevOps: GitLab (gitlab), Nexus (nexus), Registry (registry-nexus), ArgoCD (argocd).
Ops: Grafana (grafana), Prometheus (prom), Alertmanager (alertmanager), MinIO (minio).
Data: PostgreSQL 16, Redis.
IoT: Frigate (frigate).