–°–≤–æ–¥–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ (–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è)
üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
–í–µ—Ä—Å–∏—è Kubernetes: v1.28.15
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤: 7 —É–∑–ª–æ–≤ (3 control-plane, 4 worker)
–î–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ –û–°: RED OS 8.0 (–∞–Ω–∞–ª–æ–≥ RHEL/CentOS)
Container Runtime: CRI-O v1.32.6

üåê –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
Kubernetes API: 10.10.2.110 (–≤–Ω–µ—à–Ω–∏–π –∞–¥—Ä–µ—Å)
Ingress Controller: 10.10.2.111 (–≤–Ω–µ—à–Ω–∏–π –∞–¥—Ä–µ—Å)
Pod —Å–µ—Ç—å: 10.233.0.0/16
Service —Å–µ—Ç—å: 10.233.0.0/16
–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ IP —É–∑–ª–æ–≤: 10.10.2.100-106
LoadBalancer: MetalLB v0.15.2 (L2 mode), –ø—É–ª 10.10.2.111
Ingress: Nginx Ingress v1.9.6
–î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è: ccsfarm.local

üíæ –•—Ä–∞–Ω–∏–ª–∏—â–µ
–û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: NFS –Ω–∞ 10.10.1.53:/tank01/VM_storage (>300TB)
StorageClass: managed-nfs-storage (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
Provisioner: nfs-subdir-external-provisioner v4.0.1
MinIO: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
–í–∞–∂–Ω–æ–µ: –î–ª—è —Ä–∞–±–æ—Ç—ã —Å NFS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è securityContext.runAsUser: 65534

üöÄ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
–†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
ArgoCD v3.12+: GitOps —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º TLS –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
Cert-manager: –°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ ClusterIssuer
Nginx Ingress: –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º —á–µ—Ä–µ–∑ 10.10.2.111
MinIO: –û–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ + MinIO Console
Kubernetes API: –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ 10.10.2.110

–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
GitLab: –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π –∏ CI/CD

üîß –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
DNS Resolution
–ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–º–µ–Ω –∏–∑-–∑–∞ wildcard-–∑–∞–ø–∏—Å–∏ –≤ BIND9
–†–µ—à–µ–Ω–∏–µ: –£–¥–∞–ª–µ–Ω–∞ wildcard-–∑–∞–ø–∏—Å—å –∏–∑ –∑–æ–Ω—ã ccsfarm.local
–†–µ–∑—É–ª—å—Ç–∞—Ç: –°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö DNS-–∏–º–µ–Ω

–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ NFS
–ü—Ä–æ–±–ª–µ–º–∞: chown: /var/lib/postgresql/data: Operation not permitted
–†–µ—à–µ–Ω–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ securityContext.runAsUser: 65534 –¥–ª—è –≤—Å–µ—Ö Pod'–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö NFS
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
yaml
securityContext:
  runAsUser: 65534
  runAsNonRoot: true

‚ö†Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
–°–µ—Ç–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
External Traffic Policy: Local (–≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å hairpin traffic)
DNS: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π BIND9 —Å–µ—Ä–≤–µ—Ä (10.10.1.151)
–î–æ—Å—Ç—É–ø –∫ GitHub: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –≤–º–µ—Å—Ç–æ SSH

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–†–µ–∂–∏–º: Development/Staging (–Ω–µ production-ready)
–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã: –°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ cert-manager
–î–æ—Å—Ç—É–ø: –ß–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ–º–µ–Ω ccsfarm.local

üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
–î–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
–í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞—Ç—å securityContext.runAsUser: 65534 –¥–ª—è Pod'–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö NFS
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π StorageClass managed-nfs-storage
–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å Ingress —Å –¥–æ–º–µ–Ω–æ–º *.ccsfarm.local —á–µ—Ä–µ–∑ 10.10.2.111
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MinIO –¥–ª—è –æ–±—ä–µ–∫—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è, –≥–¥–µ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏
GitLab - –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π –∏ CI/CD
PostgreSQL + PgAdmin - –∫–∞–∫ –±–∞–∑–∞ –¥–ª—è GitLab –∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
–°–ª–µ–¥–∏—Ç—å –∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –≤–Ω–µ—à–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º
–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–º–µ–Ω—É externalTrafficPolicy –Ω–∞ Cluster –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∞

–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: –ö–ª–∞—Å—Ç–µ—Ä —Å—Ç–∞–±–∏–ª–µ–Ω, –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (ArgoCD, MinIO, Nginx Ingress). –ì–æ—Ç–æ–≤ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ GitLab –∏ –¥—Ä—É–≥–∏—Ö –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

# üìë –°–≤–æ–¥–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ (v3.0)
**–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:** 22 –ù–æ—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** Production / On-premise / Secured (HTTPS)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
*   **–í–µ—Ä—Å–∏—è Kubernetes:** v1.28.15
*   **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤:** 7 —É–∑–ª–æ–≤ (3 Control-plane, 4 Worker)
*   **–û–°:** RED OS 8.0
*   **Container Runtime:** CRI-O v1.32.6
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (PKI):** –†–∞–∑–≤–µ—Ä–Ω—É—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π **Internal Root CA** (—á–µ—Ä–µ–∑ `cert-manager`). –ö–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ —Ä–∞–±–æ—á–∏—Ö —Å—Ç–∞–Ω—Ü–∏—è—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

## üåê –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
*   **–î–æ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞:** `ccsfarm.local`
*   **–í–Ω–µ—à–Ω–∏–µ –∞–¥—Ä–µ—Å–∞:**
    *   Kubernetes API: `10.10.2.110`
    *   Ingress Controller (VIP): `10.10.2.111`
*   **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è:**
    *   **Service —Å–µ—Ç—å:** `10.233.0.0/18`
    *   **Pod —Å–µ—Ç—å:** `10.233.64.0/18`
*   **Ingress:** Nginx Ingress v1.9.6 + MetalLB (L2 mode).
*   **–°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `kube-controller-manager`, `kube-scheduler`, `etcd` –ø–µ—Ä–µ–Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ `0.0.0.0` –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.

## üíæ –•—Ä–∞–Ω–∏–ª–∏—â–µ
*   **NFS:** `10.10.1.53:/tank01/VM_storage` (>300TB)
*   **StorageClass:** `managed-nfs-storage` (default)
*   **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** `securityContext.runAsUser: 65534` (nobody).

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –°–ï–†–¢–ò–§–ò–ö–ê–¢–´
*   **Issuer:** `ccsfarm-ca-issuer` (ClusterIssuer).
*   **Root CA:** –•—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–µ–∫—Ä–µ—Ç–µ, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω –Ω–∞ –Ω–æ–¥—ã —á–µ—Ä–µ–∑ `update-ca-trust`.
*   **HTTPS:** –í–∫–ª—é—á–µ–Ω –¥–ª—è –≤—Å–µ—Ö –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (GitLab, Nexus, Grafana, Prometheus –∏ –¥—Ä.).

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì (Kube-Prometheus-Stack)
*   **–°—Ç–µ–∫:** Prometheus + Alertmanager + Grafana + NodeExporter.
*   **–í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø:**
    *   **Grafana:** `https://grafana.ccsfarm.local` (admin/admin).
    *   **Prometheus:** `https://prom.ccsfarm.local` (–∑–∞—â–∏—â–µ–Ω Basic Auth).
*   **–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã (Exporters):**
    *   **Redis:** `redis-exporter` (–ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Redis).
    *   **Postgres:** `postgres-exporter` (–ø–æ–¥–∫–ª—é—á–µ–Ω —á–µ—Ä–µ–∑ DSN —Å—Ç—Ä–æ–∫—É).
    *   **MinIO:** –ù–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—Ä–µ–∂–∏–º `public`).
    *   **Cert-Manager:** –ù–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏.
*   **ServiceMonitors:** –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è GitLab (Webservice, Workhorse, Sidekiq), Runner, MinIO, Cert-Manager.

---

## ‚úÖ –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ù–´–ï –°–ï–†–í–ò–°–´

### üì¶ Nexus Repository Manager (HTTPS)
*   **UI / Maven / NuGet:** `https://nexus.ccsfarm.local` (–ø–æ—Ä—Ç 8081).
*   **Docker Registry:** `https://registry-nexus.ccsfarm.local` (–ø–æ—Ä—Ç 8082).
*   **Auth:** –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω `Docker Bearer Token Realm` (–¥–ª—è Kaniko).

### üóÑÔ∏è MinIO (Object Storage)
*   **–î–æ—Å—Ç—É–ø:** `https://minio.ccsfarm.local`
*   **–†–µ–∂–∏–º:** 3 –Ω–æ–¥—ã.
*   **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:** GitLab Runner –æ–±—â–∞–µ—Ç—Å—è —Å MinIO –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø–æ HTTP (`minio.minio.svc...`) –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ç–µ–ª—å SSL.

### üêò –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
*   **PostgreSQL 16:** –í–Ω–µ—à–Ω–∏–π StatefulSet, –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–º.
*   **Redis:** Standalone, –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–º.

---

## üîß GITLAB 18 (–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å)
*   **URL:** `https://gitlab.ccsfarm.local`
*   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
    *   **IP Whitelist:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ—Ç—å `10.233.0.0/16` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ü—Ä–æ–º–µ—Ç–µ—É—Å–∞ –∫ –º–µ—Ç—Ä–∏–∫–∞–º –±–µ–∑ –ø–∞—Ä–æ–ª—è.
    *   **Workhorse Metrics:** –í–∫–ª—é—á–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É `9229`.
    *   **HTTPS:** –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç Internal CA.

### üèÉ GitLab Runner & CI/CD
*   **–¢–∏–ø:** Kubernetes Executor.
*   **SSL:** –í –ø–æ–¥—ã Runner'–∞ –∏ –ø–æ–¥—ã —Å–±–æ—Ä–æ–∫ (Jobs) –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è **Root CA** –≤ –ø–∞–ø–∫—É `/custom-certs/` (–≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ `is a directory`).
*   **–°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (Kaniko):**
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `registry-nexus.ccsfarm.local`.
    *   –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç CA –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `--registry-certificate`.
    *   –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `config.json` —Å —Ç–æ—á–Ω—ã–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ–º —Ö–æ—Å—Ç–∞.

---

## ‚ö†Ô∏è –ö–ê–†–¢–ê –î–û–°–¢–£–ü–ê (Endpoints)
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ **HTTPS** —Å –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º:

1.  **GitLab:** `gitlab.ccsfarm.local`
2.  **Nexus UI:** `nexus.ccsfarm.local`
3.  **Nexus Docker:** `registry-nexus.ccsfarm.local`
4.  **Grafana:** `grafana.ccsfarm.local`
5.  **Prometheus:** `prom.ccsfarm.local`
6.  **Alertmanager:** `alertmanager.ccsfarm.local`
7.  **MinIO:** `minio.ccsfarm.local`
8.  **ArgoCD:** `argocd.ccsfarm.local`
9.  **PgAdmin:** `pg.ccsfarm.local`
10. **Frigate:** `frigate.ccsfarm.local`



–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ **–ø–æ–ª–Ω–∞—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —Å–≤–æ–¥–∫–∞ (v4.0)**. –û–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –≤–∞—à–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–∑ —Å—Ç–∞—Ä–æ–π —Å–≤–æ–¥–∫–∏ (GitLab, Nexus, –°–µ—Ç—å) –∏ –∞–∫—Ç—É–∞–ª—å–Ω—É—é, —Ä–∞–±–æ—Ç–∞—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –≤–∞—à–∞ —Ç–æ—á–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ ("Save Point") –¥–ª—è –ª—é–±—ã—Ö –±—É–¥—É—â–∏—Ö —Ä–∞–±–æ—Ç.

---

# üìë –°–≤–æ–¥–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ (v4.0)
**–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:** 23 –ù–æ—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** Production / Stable / Full Observability
**–¢–µ–∫—É—â–µ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ:** –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ Loki –≤ —Ä–µ–∂–∏–º–µ Simple Scalable —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤ –≤ MinIO (S3).

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
*   **–ö–ª–∞—Å—Ç–µ—Ä:** v1.28.15, 7 —É–∑–ª–æ–≤ (3 Control-plane, 4 Worker).
*   **–û–° / Runtime:** RED OS 8.0 / CRI-O v1.32.6.
*   **–•—Ä–∞–Ω–∏–ª–∏—â–µ (Storage):**
    *   **NFS:** `10.10.1.53:/tank01/VM_storage` (>300TB).
    *   **StorageClass:** `managed-nfs-storage` (–ø—Ä–∞–≤–∞ `nobody:65534`).
    *   **S3 (MinIO):** –ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 3 –Ω–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–æ–≤ (Loki), –±—ç–∫–∞–ø–æ–≤ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (PKI):**
    *   **Internal Root CA:** –†–∞–∑–≤–µ—Ä–Ω—É—Ç —á–µ—Ä–µ–∑ `cert-manager` + `ccsfarm-ca-issuer`.
    *   **Trust:** –ö–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–Ω–µ–¥—Ä–µ–Ω –Ω–∞ —É—Ä–æ–≤–Ω–µ –û–° –Ω–æ–¥ (`update-ca-trust`) –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ CI/CD –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.

---

## üåê –°–µ—Ç—å (Networking)
*   **–î–æ–º–µ–Ω:** `ccsfarm.local`
*   **–ê–¥—Ä–µ—Å–∞—Ü–∏—è:**
    *   **API / Ingress VIP:** `10.10.2.110` / `10.10.2.111`
    *   **Pods:** `10.233.64.0/18`
    *   **Services:** `10.233.0.0/18`
*   **Ingress:** Nginx Ingress v1.9.6 + MetalLB (L2 mode).
*   **–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã k8s (`controller-manager`, `scheduler`, `etcd`) —Å–ª—É—à–∞—é—Ç `0.0.0.0` –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.

---

## üìú –õ–û–ì–ì–ò–†–û–í–ê–ù–ò–ï (Loki Stack - –ì–û–¢–û–í–û ‚úÖ)
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Loki (Simple Scalable) + Promtail + MinIO.
**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
*   **–†–µ–∂–∏–º:** 3 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ (Read, Write, Backend) + Gateway.
*   **–•—Ä–∞–Ω–∏–ª–∏—â–µ:** MinIO (bucket `loki-data`).
*   **Discovery:** Memberlist (Ring) —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ `${POD_IP}`.
*   **–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã S3:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ **`structuredConfig`** –¥–ª—è –æ–±—Ö–æ–¥–∞ —à–∞–±–ª–æ–Ω–æ–≤ Helm.
    *   **Endpoint:** –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω `http://minio.minio.svc.cluster.local:9000`.
    *   **Auth:** –ö–ª—é—á–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ `extraEnv` (`AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`).
    *   **Flags:** `s3forcepathstyle: true` (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è MinIO).
*   **Promtail:** –°–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ —Å–æ –≤—Å–µ—Ö –Ω–æ–¥, —Ç–µ–≥–∏—Ä—É–µ—Ç –ø–æ namespace/pod/container.

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì (Kube-Prometheus-Stack)
*   **–°—Ç–µ–∫:** Prometheus + Alertmanager + Grafana + NodeExporter.
*   **–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã:**
    *   **Redis / Postgres:** –ü–æ–¥–∫–ª—é—á–µ–Ω—ã –∏ —Å–æ–±–∏—Ä–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏ –ë–î.
    *   **MinIO:** –ù–∞—Ç–∏–≤–Ω—ã–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (—Ä–µ–∂–∏–º `public`).
    *   **GitLab:** Webservice, Sidekiq, Workhorse, Runner.
*   **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** Grafana –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ Prometheus (–º–µ—Ç—Ä–∏–∫–∏) –∏ Loki (–ª–æ–≥–∏).

---

## üîß GITLAB & CI/CD
*   **–í–µ—Ä—Å–∏—è:** GitLab 18 (Omnibus/Cloud Native components).
*   **Runner:** Kubernetes Executor.
*   **–°–±–æ—Ä–∫–∞ (Kaniko):**
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π Nexus Registry (`registry-nexus.ccsfarm.local`).
    *   **SSL Fix:** –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç CA –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ `/custom-certs/` –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `--registry-certificate`.
*   **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏:** `10.233.0.0/16` –≤ Whitelist –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

---

## ‚úÖ –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ù–´–ï –°–ï–†–í–ò–°–´
1.  **Nexus Repository:**
    *   HTTPS (`nexus.ccsfarm.local`).
    *   Docker Registry –Ω–∞ –ø–æ—Ä—Ç—É 8082 (`registry-nexus...`).
    *   –ù–∞—Å—Ç—Ä–æ–µ–Ω `Docker Bearer Token Realm`.
2.  **MinIO:**
    *   –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø: `http://minio.minio.svc.cluster.local:9000` (–¥–ª—è Loki/Runner).
    *   –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø: HTTPS Console.
3.  **–ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö:**
    *   PostgreSQL 16 (StatefulSet).
    *   Redis (Standalone).

---

## ‚ö†Ô∏è –ö–ê–†–¢–ê –î–û–°–¢–£–ü–ê (Endpoints Map)
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ HTTPS:

| –°–µ—Ä–≤–∏—Å | URL | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **GitLab** | `https://gitlab.ccsfarm.local` | Main Repo / CI |
| **Nexus** | `https://nexus.ccsfarm.local` | Artifacts |
| **Registry** | `https://registry-nexus.ccsfarm.local` | Docker Images |
| **Grafana** | `https://grafana.ccsfarm.local` | Dashboards / Logs |
| **Prometheus**| `https://prom.ccsfarm.local` | Metrics Source |
| **Alertmgr** | `https://alertmanager.ccsfarm.local` | Alerts |
| **MinIO** | `https://minio.ccsfarm.local` | S3 Browser |
| **ArgoCD** | `https://argocd.ccsfarm.local` | GitOps |
| **PgAdmin** | `https://pg.ccsfarm.local` | DB Admin |
| **Frigate** | `https://frigate.ccsfarm.local` | NVR |

---
### üìù –ß—Ç–æ –¥–∞–ª—å—à–µ?
–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫:
1.  –ù–∞—Å—Ç—Ä–æ–π–∫–µ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ –≤ Prometheus (–ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è Loki —É–∂–µ –µ—Å—Ç—å –≤ —á–∞—Ä—Ç–µ).
2.  –í–≤–æ–¥—É Bare Metal –Ω–æ–¥—ã (–∫–æ—Ç–æ—Ä–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–∞—Å—å –¥–ª—è –ë–î).
3.  –¢—é–Ω–∏–Ω–≥—É Retention Policy –¥–ª—è –ª–æ–≥–æ–≤ (—Å–µ–π—á–∞—Å 30 –¥–Ω–µ–π).
---

üìë –°–≤–æ–¥–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ (v5.0)



–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏: 23 –ù–æ—è–±—Ä—è 2025
–°—Ç–∞—Ç—É—Å: Production Ready / Full Observability
–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ (NTP), –Ω–∞—Å—Ç—Ä–æ–µ–Ω Alertmanager (Telegram), –∑–∞–ø—É—â–µ–Ω Loki (S3).
üèóÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
–ö–ª–∞—Å—Ç–µ—Ä: Kubernetes v1.28.15 (7 —É–∑–ª–æ–≤: 3 CP, 4 Worker).
–û–°: RED OS 8.0 (RHEL-based) + CRI-O v1.32.6.
–í—Ä–µ–º—è (NTP): –ù–∞—Å—Ç—Ä–æ–µ–Ω chronyd —Å –ø—É–ª–∞–º–∏ Yandex/Google.
–°–µ—Ç—å:
CNI: Calico.
Ingress: Nginx + MetalLB (VIP: 10.10.2.111).
DNS: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∑–æ–Ω–∞ ccsfarm.local (–±–µ–∑ wildcard).
–•—Ä–∞–Ω–∏–ª–∏—â–µ:
NFS: –û—Å–Ω–æ–≤–Ω–æ–µ (managed-nfs-storage), –ø—Ä–∞–≤–∞ nobody:65534.
MinIO: S3 Object Storage (3 –Ω–æ–¥—ã) –¥–ª—è –ª–æ–≥–æ–≤, –±—ç–∫–∞–ø–æ–≤ –∏ GitLab.
üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (PKI)
CA: –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π Internal Root CA (—á–µ—Ä–µ–∑ cert-manager).
Trust: –ö–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–Ω–µ–¥—Ä–µ–Ω –Ω–∞ —Ö–æ—Å—Ç—ã –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ CI/CD –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
HTTPS: –¢–æ—Ç–∞–ª—å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.
üëÅÔ∏è –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (Observability)
1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus Stack)
–°—Ç–µ–∫: Prometheus + Alertmanager + Grafana + NodeExporter.
–ê–ª–µ—Ä—Ç–∏–Ω–≥:
–ö–∞–Ω–∞–ª: Telegram.
–í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏: –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ https://prom.ccsfarm.local.
–ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ (Inhibition): –í–∫–ª—é—á–µ–Ω–æ (Critical –≥–ª—É—à–∏—Ç Info).
–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã: Redis, Postgres, GitLab, MinIO, Cert-Manager.
2. –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Loki Stack)
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Simple Scalable (Read/Write/Backend).
–•—Ä–∞–Ω–∏–ª–∏—â–µ: MinIO (bucket loki-data).
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ structuredConfig –¥–ª—è –ø—Ä—è–º–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ S3.
Ruler: –í–∫–ª—é—á–µ–Ω, —Å–≤—è–∑–∞–Ω —Å Alertmanager.
üì¶ –ö–ª—é—á–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã (Endpoints)
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ HTTPS:
DevOps: GitLab (gitlab), Nexus (nexus), Registry (registry-nexus), ArgoCD (argocd).
Ops: Grafana (grafana), Prometheus (prom), Alertmanager (alertmanager), MinIO (minio).
Data: PostgreSQL 16, Redis.
IoT: Frigate (frigate).

 **–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∏ –ø–æ–ª–Ω–∞—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ (v5.2)**. 

---

# üìë –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ Kubernetes (v5.2 Final)
**–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:** 24 –ù–æ—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** Production Ready / Secured / Full Observability

## 1. üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
*   **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Bare Metal / Proxmox VMs.
*   **–í–µ—Ä—Å–∏—è Kubernetes:** v1.28.15.
*   **–£–∑–ª—ã (7 —à—Ç):**
    *   **Control Plane (3):** `k8s-master`, `k8s-control01`, `k8s-control02`.
    *   **Workers (4):** `k8s-worker01` .. `k8s-worker04`.
*   **–û–°:** RED OS 8.0 (RHEL-based) + CRI-O v1.32.6.
*   **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (`chronyd` + –ø—É–ª—ã Yandex/Google).

## 2. üåê –°–µ—Ç—å –∏ DNS
*   **–î–æ–º–µ–Ω:** `ccsfarm.local` (Internal CA).
*   **–í–Ω–µ—à–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ (MetalLB L2):** API `10.10.2.110`, Ingress VIP `10.10.2.111`.
*   **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ç–∏:** Pods `10.233.64.0/18`, Services `10.233.0.0/18`.
*   **Ingress:** Nginx (v1.9.6), `externalTrafficPolicy: Local`.

## 3. üíæ –°–∏—Å—Ç–µ–º–∞ –•—Ä–∞–Ω–µ–Ω–∏—è –î–∞–Ω–Ω—ã—Ö
*   **NFS (–û—Å–Ω–æ–≤–Ω–æ–µ):** `managed-nfs-storage` (>300TB).
    *   **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** `runAsUser: 65534` (nobody) –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö.
*   **MinIO (S3 Object Storage):**
    *   –ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 3 –Ω–æ–¥.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: Loki (Logs), Velero (Backups), GitLab (Artifacts/LFS).

## 4. üöÄ GITLAB & CI/CD (Production ‚úÖ)
*   **–í–µ—Ä—Å–∏—è:** GitLab 18 (Omnibus/Cloud Native components).
*   **URL:** `https://gitlab.ccsfarm.local`
*   **Runner:** Kubernetes Executor (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π).
*   **CI/CD (Kaniko):**
    *   –†–µ–¥–∂–∏—Å—Ç—Ä–∏: –õ–æ–∫–∞–ª—å–Ω—ã–π Nexus (`registry-nexus.ccsfarm.local`).
    *   **SSL Fix:** –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç Internal CA –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–±–æ—Ä–∫–∏ –≤ `/custom-certs/` –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `--registry-certificate`, —á—Ç–æ–±—ã Kaniko –¥–æ–≤–µ—Ä—è–ª —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–º—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É Nexus.
*   **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
    *   IP Whitelist `10.233.0.0/16` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ GitLab –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ Prometheus –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

## 5. üëÅÔ∏è –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (Observability Stack)
### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus Stack)
*   **–°—Ç–µ–∫:** Prometheus + Alertmanager + Grafana + NodeExporter.
*   **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** Grafana –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ Prometheus (–º–µ—Ç—Ä–∏–∫–∏) –∏ Loki (–ª–æ–≥–∏).
*   **–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã (Target Health):**
    *   **GitLab:** Webservice, Sidekiq, Workhorse, Runner (–ø–æ–ª–Ω—ã–π –æ—Ö–≤–∞—Ç).
    *   **–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:** Redis, PostgreSQL.
    *   **MinIO:** Native metrics (—Ä–µ–∂–∏–º public).
    *   **Cert-Manager:** Native metrics.
*   **–ê–ª–µ—Ä—Ç–∏–Ω–≥:**
    *   –ö–∞–Ω–∞–ª: **Telegram**.
    *   –ü—Ä–∞–≤–∏–ª–∞: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ k8s + –∫–∞—Å—Ç–æ–º–Ω—ã–µ (SSL, MinIO, Time Drift, Ingress Errors).

### üìú –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Loki)
*   **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Simple Scalable (S3 backend).
*   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `structuredConfig` —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º `s3forcepathstyle: true` –¥–ª—è MinIO.
*   **Ruler:** –ê–∫—Ç–∏–≤–µ–Ω, –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≥–æ–≤ –≤ Alertmanager.

## 6. üöë –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (Disaster Recovery)
### –≠—à–µ–ª–æ–Ω 1: Velero (Apps & Data)
*   **–•—Ä–∞–Ω–∏–ª–∏—â–µ:** S3 MinIO (`velero-backups`).
*   **–ú–µ—Ç–æ–¥ (NFS):** File System Backup (FSB/Restic).
*   **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ:** –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è `backup.velero.io/backup-volumes: <volume-name>` –≤ Deployment/StatefulSet –¥–ª—è –±—ç–∫–∞–ø–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ NFS-—Ç–æ–º–æ–≤.

### –≠—à–µ–ª–æ–Ω 2: Etcd (Cluster State)
*   **–ú–µ—Ç–æ–¥:** –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã + –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ NFS –º–∞—É–Ω—Ç `/mnt/k8s-backup` —á–µ—Ä–µ–∑ Cron.

## 7. –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ù–´–ï –°–ï–†–í–ò–°–´
### ‚úÖ –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ù–´–ï –°–ï–†–í–ò–°–´
1.  **Nexus Repository:**
    *   200Gb
    *   HTTPS (`nexus.ccsfarm.local`).
    *   Docker Registry –Ω–∞ –ø–æ—Ä—Ç—É 8082 (`registry-nexus.ccsfarm.local`).
    *   –ù–∞—Å—Ç—Ä–æ–µ–Ω `Docker Bearer Token Realm`.
2.  **MinIO:**
    *   3 –Ω–æ–¥—ã –ø–æ 100Gb
    *   –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø: `http://minio.minio.svc.cluster.local:9000` (–¥–ª—è Loki/Runner).
    *   –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø: HTTPS Console.
3.  **–ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö:**
    *   PostgreSQL 16 (StatefulSet).
    *   Redis (Standalone).

---

## ‚ö†Ô∏è –ö–ê–†–¢–ê –î–û–°–¢–£–ü–ê (Endpoints Map)
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ HTTPS:

| –°–µ—Ä–≤–∏—Å | URL | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **GitLab** | `https://gitlab.ccsfarm.local` | Main Repo / CI |
| **Nexus** | `https://nexus.ccsfarm.local` | Artifacts |
| **Registry** | `https://registry-nexus.ccsfarm.local` | Docker Images |
| **Grafana** | `https://grafana.ccsfarm.local` | Dashboards / Logs |
| **Prometheus**| `https://prom.ccsfarm.local` | Metrics Source |
| **Alertmgr** | `https://alertmanager.ccsfarm.local` | Alerts |
| **MinIO** | `https://minio.ccsfarm.local` | S3 Browser |
| **ArgoCD** | `https://argocd.ccsfarm.local` | GitOps |
| **PgAdmin** | `https://pg.ccsfarm.local` | DB Admin |
| **Frigate** | `https://frigate.ccsfarm.local` | NVR |

**–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞.**

–ü—Ä–∏–≤–µ—Ç! –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –Ω–æ–¥—ã (–Ω–∞–∑–æ–≤–µ–º –µ—ë **Node-GPU**) –≤–ø–µ—á–∞—Ç–ª—è–µ—Ç. –≠—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–π "Computation Heavy" —É–∑–µ–ª, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ª–∏—á–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç —Ç–µ–∫—É—â–∏–µ "General Purpose" –Ω–æ–¥—ã Supermicro. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ 3 –Ω–æ–¥—ã –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Proxmox HA –∏ Kubernetes Quorum.

–ù–∏–∂–µ –º–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–µ —Å—Ö–µ–º—ã —Ö—Ä–∞–Ω–∏–ª–∏—â –∏ –æ–±—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —É—á–µ—Ç–æ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ —Ç–≤–æ–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ (Kubernetes + ML + Longhorn).

---

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –•—Ä–∞–Ω–∏–ª–∏—â (Storage Layout)

–¢–≤–æ—è —Å—Ö–µ–º–∞ –≤ —Ü–µ–ª–æ–º —Ä–∞–±–æ—á–∞—è, –Ω–æ —è –ø—Ä–µ–¥–ª–∞–≥–∞—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –µ—ë –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ (ZFS) –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Longhorn/ML), –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è "–±—É—Ç—ã–ª–æ—á–Ω—ã–µ –≥–æ—Ä–ª—ã—à–∫–∏".

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–∞—Ä—Ç–∞ –¥–∏—Å–∫–æ–≤ –¥–ª—è Node-GPU:

| –§–∏–∑–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (Proxmox ID) | –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ / –¢–∏–ø | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
| :--- | :--- | :--- | :--- |
| **1x 128Gb NVMe** | **Boot / OS (rpool)** | LVM-Thin (ext4) –∏–ª–∏ ZFS (Single) | **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π —Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π –¥–∏—Å–∫ –ø–æ–¥ –û–°. Proxmox –∑–∞–Ω–∏–º–∞–µ—Ç ~16-32Gb. 512Gb –ø–æ–¥ —Å–∏—Å—Ç–µ–º—É ‚Äî —ç—Ç–æ —Ä–∞—Å—Ç–æ—á–∏—Ç–µ–ª—å—Å—Ç–≤–æ. 128Gb —Ö–≤–∞—Ç–∏—Ç —Å –≥–æ–ª–æ–≤–æ–π –¥–ª—è ISO –∏ —Å–∞–º–æ–π OS. |
| **1x 1Tb NVMe** | **Longhorn Dedicated** | LVM –∏–ª–∏ ZFS (Single) | **–ö—Ä–∏—Ç–∏—á–Ω–æ:** Longhorn —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫. –û—Ç–¥–∞–π –µ–º—É —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –¥–∏—Å–∫. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç –≤—ã—Å–æ–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏ (–≥–¥–µ —É–∂–µ –µ—Å—Ç—å SSD). |
| **3x 960Gb SATA** | **Fast VM Storage** | **ZFS RAIDZ1** (~1.8TB usable) | **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –û–±—ä–µ–¥–∏–Ω–∏ –≤—Å–µ —Ç—Ä–∏ SSD –≤ –æ–¥–∏–Ω –ø—É–ª. RAIDZ1 –¥–∞—Å—Ç –∑–∞—â–∏—Ç—É –æ—Ç –≤—ã–ª–µ—Ç–∞ 1 –¥–∏—Å–∫–∞ –∏ –ø–æ—á—Ç–∏ —É–¥–≤–æ–µ–Ω–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è. –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –¥–∏—Å–∫–æ–≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω –∏ –≥–æ—Ä—è—á–∏—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤ Longhorn). |
| **1x 512Gb SATA** | **Scratch / Cache / Wal** | ZFS Special Device / L2ARC | **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ `Special Device` (Metadata) –¥–ª—è HDD –ø—É–ª–∞ (—É—Å–∫–æ—Ä–∏—Ç MinIO –ª–∏—Å—Ç–∏–Ω–≥) –∏–ª–∏ –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –¥–ª—è ML –¥–∞—Ç–∞—Å–µ—Ç–æ–≤. |
| **2x 4TB HDD** | **MinIO / Backup** | **ZFS Mirror** | –ù–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. **–°–æ–≤–µ—Ç:** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π 128GB NVMe –∫–∞–∫ –∫—ç—à (L2ARC) –¥–ª—è —ç—Ç–æ–≥–æ –ø—É–ª–∞, –µ—Å–ª–∏ RAM < 128GB. ZFS —Å–Ω–∞—á–∞–ª–∞ –µ—Å—Ç RAM (ARC). L2ARC –Ω–∞ –∑–µ—Ä–∫–∞–ª–µ HDD –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É —Ç–µ–±—è –æ—á–µ–Ω—å "–≥–æ—Ä—è—á–µ–µ" —á—Ç–µ–Ω–∏–µ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö. –õ—É—á—à–µ –¥–æ–±–∞–≤—å NVMe –∫–∞–∫ `Log` (ZIL), –µ—Å–ª–∏ –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏. |
| **1x 12TB HDD** | **NVR / Junk** | Directory / ZFS Single | –î–ª—è Frigate –∏ Docker Proxy blobs. –ï—Å–ª–∏ —É–º—Ä–µ—Ç ‚Äî –Ω–µ –∂–∞–ª–∫–æ, —Å–∫–∞—á–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ. |

**–ü–æ—á–µ–º—É —Ç–∞–∫ –ª—É—á—à–µ:**
1.  **OS –Ω–∞ 128Gb NVMe:** –°–∏—Å—Ç–µ–º–∞ –≥—Ä—É–∑–∏—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –ª–æ–≥–æ–≤ –ø–∏—à–µ—Ç –º–Ω–æ–≥–æ, NVMe —Å —ç—Ç–∏–º —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è. –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º 512Gb SATA.
2.  **RAIDZ1 –Ω–∞ 3-—Ö SSD:** –¢—ã –ø–æ–ª—É—á–∞–µ—à—å –µ–¥–∏–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ ~1.8 –¢–ë —Å –∑–∞—â–∏—Ç–æ–π –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ª—É—á—à–µ, —á–µ–º "–∑–µ—Ä–∫–∞–ª–æ + –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–∏—Å–∫", —Ç–∞–∫ –∫–∞–∫ —É —Ç–µ–±—è –Ω–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –∏ –≤—ã—à–µ —Å–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è.
3.  **1TB NVMe –ø–æ–¥ Longhorn:** ML –∑–∞–¥–∞—á–∏ –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ `iowait`. NVMe –∑–¥–µ—Å—å must-have.

---

### 2. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ (3 Nodes)

–° –≤–≤–æ–¥–æ–º —Ç—Ä–µ—Ç—å–µ–π –Ω–æ–¥—ã —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫–≤–æ—Ä—É–º.

#### 2.1. –¢–æ–ø–æ–ª–æ–≥–∏—è Kubernetes (Control Plane)
*   **–¢–µ–∫—É—â–∞—è:** 3 VM Control Plane + 4 VM Workers.
*   **–ü–ª–∞–Ω:** –†–∞–∑–Ω–µ—Å–∏ Control Plane (etcd) —Å—Ç—Ä–æ–≥–æ –ø–æ —Ä–∞–∑–Ω—ã–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –Ω–æ–¥–∞–º.
    *   `k8s-control01` -> Supermicro 1
    *   `k8s-control02` -> Supermicro 2
    *   `k8s-control03` -> **Node-GPU** (–í–Ω–∏–º–∞–Ω–∏–µ: –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–µ ML –∑–∞–¥–∞—á–∞–º–∏, CPU –º–æ–∂–µ—Ç "–∑–∞–¥—ã—Ö–∞—Ç—å—Å—è", —á—Ç–æ –æ–ø–∞—Å–Ω–æ –¥–ª—è etcd. –°–º. –ø—É–Ω–∫—Ç 2.2).

#### 2.2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ Taints (–í–∞–∂–Ω–æ –¥–ª—è ML)
Xeon v3/v4 –º–æ—â–Ω—ã–µ, –Ω–æ 3090 –±—É–¥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã—Ö –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ.
1.  **–í—ã–¥–µ–ª–µ–Ω–∏–µ GPU:** –ò—Å–ø–æ–ª—å–∑—É–π PCI Passthrough –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞ *–æ–±–µ–∏—Ö* –∫–∞—Ä—Ç –≤ –æ–¥–Ω—É –º–æ—â–Ω—É—é VM (–Ω–∞–∑–æ–≤–µ–º –µ—ë `k8s-gpu-worker`).
2.  **Taints & Tolerations:**
    –ù–∞ —ç—Ç—É –Ω–æ–¥—É (`k8s-gpu-worker`) –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–≤–µ—Å—å Taint:
    ```bash
    kubectl taint nodes gpu-node accelerator=nvidia:NoSchedule
    ```
    –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –∑–∞–ø—É—Å–∫ –æ–±—ã—á–Ω—ã—Ö –ø–æ–¥–æ–≤ (—Ç–∏–ø–∞ nginx –∏–ª–∏ gitlab-runner) –Ω–∞ —ç—Ç–æ–π –Ω–æ–¥–µ, –æ—Å—Ç–∞–≤–ª—è—è CPU –∏ RAM —Å–≤–æ–±–æ–¥–Ω—ã–º–∏ –¥–ª—è ML –∑–∞–¥–∞—á –∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ LLM. –û–±—ã—á–Ω—ã–µ –ø–æ–¥—ã –ø—É—Å—Ç—å –∂–∏–≤—É—Ç –Ω–∞ Supermicro.

#### 2.3. –°–µ—Ç—å –∏ NVLink
*   **–°–µ—Ç—å:** –ê–≥—Ä–µ–≥–∞—Ü–∏—è LACP (802.3ad) ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –ø–ª–∞–Ω, –Ω–æ —É–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–≤–æ–π —Å–≤–∏—á –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **Layer 2+3 hashing**. –ï—Å–ª–∏ —Å–≤–∏—á —É–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ Layer 2 (MAC address), —Ç–æ –ø–æ—Ç–æ–∫ "–æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä -> –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä" –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–π–¥–µ—Ç –ø–æ –æ–¥–Ω–æ–π –∂–∏–ª–µ 10G, —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–µ —É–¥–≤–æ–∏—Ç—Å—è. –î–ª—è Longhorn/Ceph/Migration —ç—Ç–æ –≤–∞–∂–Ω–æ.
    *   *–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `balance-alb` (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≤–∏—á–∞), –Ω–æ LACP –Ω–∞–¥–µ–∂–Ω–µ–µ.
*   **NVLink:**
    *   Huananzhi X10X99-16D –∏–º–µ–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ PCIe —Å–ª–æ—Ç–æ–≤. 3090 Turbo (—Ç—É—Ä–±–∏–Ω–Ω—ã–µ) ‚Äî —ç—Ç–æ 2-—Å–ª–æ—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã.
    *   **–ü—Ä–æ–±–ª–µ–º–∞:** NVLink bridge –∂–µ—Å—Ç–∫–∏–π (–æ–±—ã—á–Ω–æ 3-slot –∏–ª–∏ 4-slot spacing). –ó–∞–º–µ—Ä—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å–ª–æ—Ç–∞–º–∏ PCIe x16 –Ω–∞ –ø–ª–∞—Ç–µ **–¥–æ** –ø–æ–∫—É–ø–∫–∏ –º–æ—Å—Ç–∞. –ö–∏—Ç–∞–π—Å–∫–∏–µ –ø–ª–∞—Ç—ã —á–∞—Å—Ç–æ –∏–º–µ—é—Ç –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à–∞–≥.

---

### 3. –•—Ä–∞–Ω–∏–ª–∏—â–µ MinIO (S3) –∏ "–•–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"

–¢—ã —Ö–æ—á–µ—à—å —É–±—Ä–∞—Ç—å –≤–Ω–µ—à–Ω–µ–µ NFS —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
*   **Docker Registry / Maven:** –ü–µ—Ä–µ–Ω–µ—Å–∏ –∏—Ö –Ω–∞ 12TB HDD (ZFS Single). –≠—Ç–æ –∫–µ—à, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞, –æ–±—ä–µ–º –≤–∞–∂–µ–Ω.
*   **–í–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (GitLab artifacts, Loki logs, Velero backups):**
    *   –†–∞–∑–≤–µ—Ä–Ω–∏ **MinIO Tenant** (—á–µ—Ä–µ–∑ MinIO Operator) –∏–ª–∏ Standalone MinIO –≤ Docker/Podman –Ω–∞ –Ω–æ–≤–æ–π –Ω–æ–¥–µ.
    *   –ò—Å–ø–æ–ª—å–∑—É–π **HostPath** –∏–ª–∏ **Local Persistent Volume** –≤ Kubernetes, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ ZFS Mirror (2x4TB).
    *   **–ü–æ—á–µ–º—É –Ω–µ Longhorn?** Longhorn ‚Äî —ç—Ç–æ *–±–ª–æ—á–Ω–æ–µ* —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –æ–Ω–æ –¥–µ–ª–∞–µ—Ç 3 —Ä–µ–ø–ª–∏–∫–∏. –•—Ä–∞–Ω–∏—Ç—å 3 –∫–æ–ø–∏–∏ 4–¢–ë –¥–∞–Ω–Ω—ã—Ö (–∏—Ç–æ–≥–æ 12–¢–ë) –Ω–∞ –¥–æ—Ä–æ–≥–∏—Ö SSD/–º–µ—Å—Ç–µ –ª–æ–Ω–≥—Ö–æ—Ä–Ω–∞ ‚Äî –¥–æ—Ä–æ–≥–æ. MinIO –ø–æ–≤–µ—Ä—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∏—Å–∫–æ–≤ (Direct Attached Storage) ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω "High Performance Object Storage".

---

### 4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ Hardware (Huananzhi Specific)

1.  **–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ VRM:** –ü–ª–∞—Ç—ã Huananzhi –Ω–∞ —á–∏–ø—Å–µ—Ç–µ X99 —Å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏ 2696v4 (150W TDP, –≤ –±—É—Å—Ç–µ –∂—Ä—É—Ç –ø–æ–¥ 200W) –≥—Ä–µ—é—Ç—Å—è –∫–∞–∫ –ø–µ—á–∫–∏.
    *   *–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:* –ü–æ—Å—Ç–∞–≤—å –º–∞–ª–µ–Ω—å–∫–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ã (40mm –∏–ª–∏ 60mm) –ø—Ä—è–º–æ –Ω–∞ —Ä–∞–¥–∏–∞—Ç–æ—Ä VRM (–∑–æ–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º). –ò–Ω–∞—á–µ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ (Load 100% 24/7) –º–æ—Å—Ñ–µ—Ç—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–≥—Ä–µ—Ç—å—Å—è –∏ —Å–±—Ä–æ—Å–∏—Ç—å —á–∞—Å—Ç–æ—Ç—ã –∏–ª–∏ —Å–≥–æ—Ä–µ—Ç—å.
2.  **RAM:** –¢—ã –ø–ª–∞–Ω–∏—Ä—É–µ—à—å 2696v4 (Broadwell). –û–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç DDR4 2400 MT/s. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–≤–æ—è —Ç–µ–∫—É—â–∞—è –ø–∞–º—è—Ç—å 16x6 (—Å—Ç—Ä–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, 96GB = 6 –ø–ª–∞–Ω–æ–∫ –ø–æ 16GB?) —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 4-–∫–∞–Ω–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –Ω–∞ –æ–±–æ–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞—Ö.
    *   *–°–æ–≤–µ—Ç:* –î–ª—è v3/v4 –ª—É—á—à–µ –≤—Å–µ–≥–æ –∑–∞–ø–æ–ª–Ω—è—Ç—å —Å–ª–æ—Ç—ã –∫—Ä–∞—Ç–Ω–æ 4 (4 –∫–∞–Ω–∞–ª–∞). –¢–æ –µ—Å—Ç—å 4 –∏–ª–∏ 8 –ø–ª–∞–Ω–æ–∫ –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä. –°–µ–π—á–∞—Å —É —Ç–µ–±—è 6 –ø–ª–∞–Ω–æ–∫. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –æ–¥–∏–Ω CPU —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 4 –∫–∞–Ω–∞–ª–∞ (4 –ø–ª–∞–Ω–∫–∏), –∞ –≤—Ç–æ—Ä–æ–π –≤ 2 –∫–∞–Ω–∞–ª–∞ (2 –ø–ª–∞–Ω–∫–∏). –≠—Ç–æ **—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ** —Å–Ω–∏–∑–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ CPU. –î–ª—è ML –∑–∞–¥–∞—á (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö) –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–∞. –î–æ–∫—É–ø–∏ –µ—â–µ 2 –ø–ª–∞–Ω–∫–∏ –¥–æ 128GB (8x16GB), —á—Ç–æ–±—ã –±—ã–ª–æ 4+4.

### –ò—Ç–æ–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:

1.  **Hardware:** –î–æ–∫—É–ø–∏—Ç—å 2 –ø–ª–∞–Ω–∫–∏ RAM (–≤—ã—Ä–æ–≤–Ω—è—Ç—å –∫–∞–Ω–∞–ª—ã), –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ö–ª–∞–∂–¥–µ–Ω–∏–µ VRM, –∑–∞–º–µ—Ä–∏—Ç—å —Å–ª–æ—Ç—ã –ø–æ–¥ NVLink.
2.  **Proxmox Install:** OS –Ω–∞ 128Gb NVMe.
3.  **Storage:**
    *   –°–æ–∑–¥–∞—Ç—å `zfs-mirror-hdds` (2x4TB).
    *   –°–æ–∑–¥–∞—Ç—å `zfs-raidz1-ssds` (3x960GB).
    *   –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å 1TB NVMe –ø–æ–¥ LVM/ZFS –¥–ª—è Longhorn.
    *   –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å 12TB –∫–∞–∫ Directory.
4.  **Migration:**
    *   –ü–æ–¥–Ω—è—Ç—å VM —Å GPU, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Passthrough.
    *   –í–≤–µ—Å—Ç–∏ –Ω–æ–¥—É –≤ –∫–ª–∞—Å—Ç–µ—Ä k8s.
    *   –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Taints.
    *   –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å MinIO –¥–∞–Ω–Ω—ã–µ —Å –≤–Ω–µ—à–Ω–µ–≥–æ NFS –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∏—Å–∫–∏ –Ω–æ–≤–æ–π –Ω–æ–¥—ã.

–≠—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–¥–µ–ª–∞–µ—Ç —Ç–≤–æ–π –∫–ª–∞—Å—Ç–µ—Ä –æ—á–µ–Ω—å –º–æ—â–Ω—ã–º –∏ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º. –£–¥–∞—á–∏ —Å –∑–∞–ø—É—Å–∫–æ–º!